<section>
  <div class="max-w-full grid md:grid-cols-2 xl:grid-cols-3 gap-2 overflow-y-auto mb-16">
    @for (p of places; track p.id) {
    <div (click)="editPlace(p)"
      class="relative group w-full flex items-center gap-3 p-3 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900 rounded-lg cursor-pointer transition-all border border-gray-200 dark:border-gray-800 text-left">
      <button type="button"
        class="cursor-pointer absolute top-1 right-1 size-8 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-lg shadow transition"
        (click)="deletePlace(p); $event.stopPropagation()">
        <i class="pi pi-times text-xs"></i>
      </button>

      <div class="w-14 h-14 rounded overflow-hidden bg-gray-100 dark:bg-gray-800">
        <img [src]="p.image || 'favicon.png'" class="w-full h-full object-cover" />
      </div>

      <div class="flex-1 min-w-0">
        <h3 class="text-sm font-semibold text-gray-900 dark:text-white truncate"
          [class]="isPlaceValid(p) ? undefined : 'text-red-500 font-semibold invalid-content'">
          {{ p.name }}
        </h3>
        <p class="text-xs text-gray-600 dark:text-gray-400 truncate mt-0.5">
          {{ p.place }}
        </p>

        <div class="flex flex-wrap gap-1 mt-1.5">
          <span class="flex items-center px-1.5 py-0.5 rounded text-xs"
            [class]="p.allowdog ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-950 dark:text-emerald-400' : 'bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-500'">
            üê∂
          </span>

          <span class="flex items-center gap-0.5 px-1.5 py-0.5 rounded text-xs font-medium"
            [class]="p.visited ? 'bg-blue-100 text-blue-700 dark:bg-blue-950 dark:text-blue-400' : 'bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-500'">
            <i class="pi" style="font-size: 12px;" [class]="p.visited ? 'pi-eye' : 'pi-eye-slash'"></i>
          </span>

          @if (p.category_id) {
          <span class="flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium max-w-[90px]"
            [style.color]="categoryIDToCategory(p.category_id).color"
            [style.background-color]="categoryIDToCategory(p.category_id).color + '15'"
            class="bg-blue-100 text-blue-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded flex gap-2 items-center truncate dark:bg-blue-100/85"><i
              class="pi pi-box text-xs"></i>{{ categoryIDToCategory(p.category_id).name }}</span>
          }
        </div>
      </div>
    </div>
    }
  </div>

  <div class="fixed inset-x-0 bottom-0 z-20 flex justify-center p-4">
    <div
      class="flex w-full max-w-lg items-center justify-between gap-3 rounded-lg border border-surface-200/70 bg-surface-0/90 px-4 py-2.5 shadow-sm backdrop-blur-md dark:border-surface-700/70 dark:bg-surface-900/90">
      <div class="flex flex-col min-w-0">
        <span class="text-xs font-semibold text-surface-700 dark:text-surface-200 truncate">
          {{ places.length }} places to add
        </span>
        <span class="text-xs text-surface-500 dark:text-surface-400 truncate">
          Confirm to create the places
        </span>
      </div>

      <div class="shrink-0 flex items-center justify-end gap-2">
        @if (linkToTripID) {
        <p-button icon="pi pi-times" size="small" severity="danger" label="To Trip" text (click)="cancelLinkToTrip()" />
        } @else {
        <p-button icon="pi pi-link" size="small" severity="secondary" label="To Trip" text (click)="openTripsModal()" />
        }
        <p-button (click)="closeDialog()" label="Confirm" size="small" severity="secondary" />
      </div>
    </div>
  </div>
</section>

<p-dialog header="Select a Trip" [draggable]="false" [dismissableMask]="true" [modal]="true" appendTo="body"
  [(visible)]="isTripsDialogVisible" styleClass="w-[95%] md:w-[40%] lg:w-[30%]">
  <div class="grid grid-cols-1 gap-2 px-4 py-2 md:grid-cols-2 lg:grid-cols-3">
    @for (trip of (trips$ | async); track trip.id) {
    <div (click)="linkToTrip(trip)" class="group relative cursor-pointer rounded-xl border border-transparent p-3 transition-colors hover:border-surface-200
          hover:bg-surface-50 dark:hover:border-surface-700 dark:hover:bg-surface-900">
      <div class="flex items-center gap-3">
        <img [src]="trip.image" loading="lazy" class="h-14 w-14 rounded object-cover" />
        <div class="min-w-0 flex-1">
          <h3 class="mb-0.5 truncate text-sm font-semibold text-gray-900 dark:text-white">
            {{ trip.name }}
          </h3>
        </div>
      </div>
    </div>
    }
  </div>
</p-dialog>